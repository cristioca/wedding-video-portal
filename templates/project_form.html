{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ title }} - Wedding Video Portal{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-plus-circle"></i> {{ title }}
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label">{% trans "Project Name" %}</label>
                        {{ form.name }}
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Client Name</label>
                            {{ form.client_name }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Client Email</label>
                            {{ form.client_email }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">{% trans "Event Type" %}</label>
                            {{ form.type }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Event Date</label>
                            {{ form.event_date }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">City</label>
                            {{ form.city }}
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="create-btn" disabled>
                        <i class="bi bi-save"></i> {% trans "Create Project" %}
                    </button>
                    <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> Cancel
                    </a>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameField = document.getElementById('id_name');
    const typeField = document.getElementById('id_type');
    const eventDateField = document.getElementById('id_event_date');
    const clientNameField = document.getElementById('id_client_name');
    const createBtn = document.getElementById('create-btn');
    
    // Set calendar to start with Monday
    if (eventDateField) {
        // Set multiple locale attributes to force Monday start
        eventDateField.setAttribute('lang', 'en-GB');
        eventDateField.setAttribute('locale', 'en-GB');
        
        // Add CSS to force Monday start in webkit browsers
        const style = document.createElement('style');
        style.textContent = `
            input[type="date"] {
                locale: en-GB;
            }
        `;
        document.head.appendChild(style);
        
        // Set the first day of week via JavaScript if browser supports it
        if (eventDateField.showPicker) {
            eventDateField.addEventListener('click', function() {
                // Force locale setting on click
                this.setAttribute('lang', 'en-GB');
            });
        }
    }
    
    function validateForm() {
        const hasName = nameField.value.trim() !== '';
        const hasType = typeField.value !== '';
        const hasEventDate = eventDateField.value !== '';
        
        createBtn.disabled = !(hasName && hasType && hasEventDate);
    }
    
    function autoFillTitle() {
        if (nameField.value.trim() === '' && typeField.value !== '') {
            let title = typeField.options[typeField.selectedIndex].text;
            if (clientNameField.value.trim() !== '') {
                title += ' - ' + clientNameField.value.trim();
            }
            nameField.value = title;
            validateForm();
        }
    }
    
    // Add event listeners
    nameField.addEventListener('input', validateForm);
    typeField.addEventListener('change', function() {
        autoFillTitle();
        validateForm();
    });
    eventDateField.addEventListener('change', validateForm);
    clientNameField.addEventListener('input', function() {
        if (typeField.value !== '' && nameField.value.includes(typeField.options[typeField.selectedIndex].text)) {
            autoFillTitle();
        }
    });
    
    // Initial validation
    validateForm();
});
</script>

{% endblock %}
